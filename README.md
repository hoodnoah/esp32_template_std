# ESP32 Rust Development Environment

A Nix-based development environment for ESP32 Rust projects. Uses the official [esp-rs/esp-idf-template](https://github.com/esp-rs/esp-idf-template) for project generation, ensuring version compatibility is maintained by the esp-rs team.

## Quick Start

### Set up your justfile.
1. Set your `TARGET` variable to the esp32 board you are targeting.
2. OPTIONAL: Set your `DEV_TARGET` variable to the host you are developing on.
  a. This is to be used for testing libraries locally.
3. OPTIONAL: Set your `LIB_NAME` variable to the name of your library crate, if you have made one. 
  a. This is where you would develop functionality which is not directly dependent upon the esp32.
     It can be tested locally, and imported by your main executable. Thus you should be careful not to 
     use dependencies which cannot be reasonably expected on the esp32 platform.

NOTE: if you intend to use a library, you must add said library to the top-level Cargo.toml so it gets picked up by your workspace.

# Run setup commands
```bash
nix develop                  # Enter development shell
just setup                   # Install ESP toolchain (one-time)
just new                     # Generate your main Rust executable project (interactive: select same target as your TARGET)
just build                   # Compile. NOTE: may fail. If so, delete .embuild, try again.
just flash                   # Flash to device and monitor
```

## What This Template Provides

This template provides the development environment and conveniences:

| File | Purpose |
|------|---------|
| `flake.nix` | Nix dev shell with system dependencies |
| `.envrc` | Direnv integration for auto-loading |
| `justfile` | Convenience commands |
| `partitions.csv` | Flash partition layout |
| `.env.example` | Template for WiFi/MQTT secrets |

The actual Rust project files (`Cargo.toml`, `src/`, `.cargo/`, etc.) are generated by running `just init`, which uses the official esp-rs template. This ensures dependency versions stay compatible with ESP-IDF.

## Commands

Run `just` to list commands

### Environment Variables

Copy `.env.example` to `main/.env` for compile-time configuration (WiFi credentials, etc.):

### Flash Partitions

`partitions.csv` defines the flash layout. Adjust sizes based on your needs and flash size.

## Using as a GitHub Template

1. On GitHub, go to repository **Settings** > **General**
2. Check **Template repository**

Then create new projects via:
- GitHub UI: Click **Use this template**
- CLI: `gh repo create my-project --template USERNAME/esp32_template --clone`
